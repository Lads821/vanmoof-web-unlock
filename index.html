<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>VanMoof Web Unlock</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; background: #f2f2f2; }
    button, input, select { font-size: 1.2em; padding: 0.5em 1em; margin: 0.5em; }
    #log { white-space: pre-wrap; background: #fff; padding: 1em; border: 1px solid #ccc; max-width: 90%; margin: auto; font-family: monospace; }
  </style>
</head>
<body>
  <h1>üîì –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ VanMoof</h1>
  <label>–í—ã–±–µ—Ä–∏—Ç–µ UUID —Å–µ—Ä–≤–∏—Å–∞:</label>
  <select id="serviceUUID">
    <option value="8e7f1a50-087a-44c9-b292-a2c628fdd9aa">8e7f1a50-087a-44c9-b292-a2c628fdd9aa</option>
    <option value="f000ffc0-0451-4000-b000-000000000000">f000ffc0-0451-4000-b000-000000000000</option>
  </select>
  <br>
  <input type="text" id="unlockCode" placeholder="–ö–æ–¥ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (32 hex)" />
  <br>
  <input type="number" id="speedLimit" placeholder="–ù–æ–≤—ã–π –ª–∏–º–∏—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ (–∫–º/—á)" min="25" max="40" />
  <br>
  <button onclick="connectAndUnlock()">üîì –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤–µ–ª–æ—Å–∏–ø–µ–¥</button>

  <div id="log"></div>

  <script>
    function log(msg) {
      const div = document.getElementById('log');
      div.textContent += msg + "\n";
    }

    async function connectAndUnlock() {
      const unlockCode = document.getElementById('unlockCode').value.trim();
      const speedLimit = parseInt(document.getElementById('speedLimit').value.trim());
      const serviceUUID = document.getElementById('serviceUUID').value;

      if (!unlockCode || unlockCode.length !== 32) {
        log("‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π 32-—Å–∏–º–≤–æ–ª—å–Ω—ã–π hex-–∫–æ–¥ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.");
        return;
      }

      try {
        log("üîç –ü–æ–∏—Å–∫ –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞...");
        const device = await navigator.bluetooth.requestDevice({
          filters: [{ namePrefix: 'VANMOOF' }],
          optionalServices: [serviceUUID]
        });

        log("üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ " + device.name + "...");
        const server = await device.gatt.connect();
        const service = await server.getPrimaryService(serviceUUID);

        const characteristics = await service.getCharacteristics();

        let codeWritten = false;
        let speedWritten = false;

        for (const char of characteristics) {
          if (char.properties.write || char.properties.writeWithoutResponse) {
            const encoder = new TextEncoder();
            const codeBytes = Uint8Array.from(unlockCode.match(/.{1,2}/g).map(byte => parseInt(byte, 16)));
            await char.writeValue(codeBytes);
            codeWritten = true;
            log("‚úÖ –ö–æ–¥ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω.");
            break;
          }
        }

        if (!codeWritten) {
          log("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞.");
          return;
        }

        if (!isNaN(speedLimit)) {
          for (const char of characteristics) {
            if (char.properties.write || char.properties.writeWithoutResponse) {
              try {
                const speedBytes = new Uint8Array([speedLimit]);
                await char.writeValue(speedBytes);
                speedWritten = true;
                log("‚úÖ –õ–∏–º–∏—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: " + speedLimit + " –∫–º/—á");
                break;
              } catch {}
            }
          }

          if (!speedWritten) {
            log("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–∏–º–∏—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏.");
          }
        }

        log("üö≤ –í–µ–ª–æ—Å–∏–ø–µ–¥ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!");
      } catch (err) {
        log("‚ùå –û—à–∏–±–∫–∞: " + err);
      }
    }
  </script>
</body>
</html>




