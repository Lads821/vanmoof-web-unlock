<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ VanMoof</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; background: #f2f2f2; }
    button, input, select { font-size: 1.2em; padding: 0.5em 1em; margin: 0.5em; }
    #log { font-family: monospace; white-space: pre-wrap; text-align: left; margin: 1em auto; max-width: 600px; background: #fff; padding: 1em; border-radius: 8px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>üîê –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ VanMoof</h1>
  <label for="uuidSelect">–í—ã–±–µ—Ä–∏—Ç–µ UUID —Å–µ—Ä–≤–∏—Å–∞:</label>
  <select id="uuidSelect">
    <option value="0000fee0-0000-1000-8000-00805f9b34fb">0000fee0-0000-1000-8000-00805f9b34fb (default)</option>
    <option value="6e400001-b5a3-f393-e0a9-e50e24dcca9e">6e400001-b5a3-f393-e0a9-e50e24dcca9e (Nordic UART)</option>
    <option value="6e400003-b5a3-f393-e0a9-e50e24dcca9e">6e400003-b5a3-f393-e0a9-e50e24dcca9e (Write)</option>
  </select>
  <br>
  <input type="text" id="unlockCode" placeholder="–í–≤–µ–¥–∏—Ç–µ 32-—Å–∏–º–≤–æ–ª—å–Ω—ã–π HEX –∫–æ–¥" />
  <br>
  <button onclick="connectAndUnlock()">üîì –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤–µ–ª–æ—Å–∏–ø–µ–¥</button>
  <div id="log"></div>

  <script>
    function log(message) {
      const logElement = document.getElementById("log");
      logElement.textContent += message + "\n";
    }

    async function connectAndUnlock() {
      log("üîç –ü–æ–∏—Å–∫ –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞...");
      const selectedUUID = document.getElementById("uuidSelect").value;
      const unlockKey = document.getElementById("unlockCode").value.trim();

      if (!/^([a-fA-F0-9]{32})$/.test(unlockKey)) {
        log("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á (–æ–∂–∏–¥–∞–µ—Ç—Å—è 32 hex —Å–∏–º–≤–æ–ª–∞)");
        return;
      }

      try {
        const device = await navigator.bluetooth.requestDevice({
          filters: [{ namePrefix: 'VANMOOF' }],
          optionalServices: [selectedUUID]
        });

        log(`üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ${device.name}...`);
        const server = await device.gatt.connect();
        const service = await server.getPrimaryService(selectedUUID);

        const characteristics = await service.getCharacteristics();
        const targetChar = characteristics.find(c => c.properties.write);
        if (!targetChar) {
          log("‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏.");
          return;
        }

        const value = new Uint8Array(unlockKey.match(/.{1,2}/g).map(byte => parseInt(byte, 16)));
        await targetChar.writeValue(value);
        log("‚úÖ –í–µ–ª–æ—Å–∏–ø–µ–¥ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!");
      } catch (error) {
        log("‚ùå –û—à–∏–±–∫–∞: " + error.message);
      }
    }
  </script>
</body>
</html>



