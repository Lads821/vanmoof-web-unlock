<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ VanMoof</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; background: #f2f2f2; }
    button, input, select { font-size: 1em; padding: 0.5em; margin: 0.5em; }
    #log { background: #fff; padding: 1em; border: 1px solid #ccc; text-align: left; max-width: 600px; margin: 2em auto; white-space: pre-wrap; font-family: monospace; }
  </style>
</head>
<body>
  <h1>üîê –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ VanMoof</h1>
  <label for="serviceUuid">–í—ã–±–µ—Ä–∏—Ç–µ UUID —Å–µ—Ä–≤–∏—Å–∞:</label>
  <select id="serviceUuid">
    <option value="f000ffc0-0451-4000-b000-000000000000" selected>f000ffc0-0451-4000-b000-000000000000</option>
    <option value="8e7f1a50-087a-44c9-b292-a2c628fdd9aa">8e7f1a50-087a-44c9-b292-a2c628fdd9aa</option>
  </select>
  <br>
  <input type="text" id="unlockCode" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (32 hex)" size="40">
  <br>
  <button onclick="connectAndUnlock()">üîì –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤–µ–ª–æ—Å–∏–ø–µ–¥</button>

  <div id="log"></div>

  <script>
    async function connectAndUnlock() {
      const log = document.getElementById("log");
      log.textContent = "üîç –ü–æ–∏—Å–∫ –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞...";

      try {
        const device = await navigator.bluetooth.requestDevice({
          filters: [{ namePrefix: 'VANMOOF' }],
          optionalServices: [document.getElementById("serviceUuid").value]
        });

        log.textContent += `\nüîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ${device.name}...`;
        const server = await device.gatt.connect();

        const serviceUuid = document.getElementById("serviceUuid").value;
        const service = await server.getPrimaryService(serviceUuid);

        const characteristics = await service.getCharacteristics();
        const writable = characteristics.find(c => c.properties.write || c.properties.writeWithoutResponse);

        if (!writable) {
          log.textContent += "\n‚ùå –ù–µ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏.";
          return;
        }

        const unlockCode = document.getElementById("unlockCode").value.trim();
        if (!/^[0-9a-fA-F]{32}$/.test(unlockCode)) {
          log.textContent += "\n‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ (–æ–∂–∏–¥–∞–µ—Ç—Å—è 32 hex —Å–∏–º–≤–æ–ª–∞).";
          return;
        }

        const value = new Uint8Array(unlockCode.match(/.{2}/g).map(b => parseInt(b, 16)));
        await writable.writeValue(value);

        log.textContent += "\n‚úÖ –í–µ–ª–æ—Å–∏–ø–µ–¥ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!";
      } catch (err) {
        log.textContent += `\n‚ùå –û—à–∏–±–∫–∞: ${err.message}`;
      }
    }
  </script>
</body>
</html>




