<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>VanMoof Web Unlock</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; background: #f2f2f2; }
    button, input, select { font-size: 1.2em; padding: 0.5em 1em; margin: 0.5em; }
    #log { white-space: pre-wrap; text-align: left; margin: 2em auto; width: 90%; max-width: 600px; background: #fff; padding: 1em; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>üîê –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ VanMoof</h1>
  <input type="text" id="encryptionKey" placeholder="32-—Å–∏–º–≤–æ–ª—å–Ω—ã–π –∫–ª—é—á (hex)" />
  <br>
  <label for="uuid">UUID —Å–µ—Ä–≤–∏—Å–∞:</label>
  <select id="uuid">
    <option value="0000fee0-0000-1000-8000-00805f9b34fb">FEE0 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)</option>
    <option value="00001810-0000-1000-8000-00805f9b34fb">1810 (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)</option>
  </select>
  <br>
  <button onclick="connectAndTestService()">üîì –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤–µ–ª–æ—Å–∏–ø–µ–¥</button>
  <div id="log"></div>

  <script>
    function log(text) {
      const logBox = document.getElementById('log');
      logBox.textContent += text + "\n";
    }

    async function connectAndTestService() {
      log("–ü–æ–∏—Å–∫ –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞...");
      try {
        const key = document.getElementById('encryptionKey').value.trim();
        if (!/^[0-9a-fA-F]{32}$/.test(key)) {
          alert("–ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á ‚Äî —Ç—Ä–µ–±—É–µ—Ç—Å—è 32 hex —Å–∏–º–≤–æ–ª–∞.");
          return;
        }

        const serviceUUID = document.getElementById('uuid').value;

        const device = await navigator.bluetooth.requestDevice({
          filters: [{ namePrefix: 'VANMOOF' }],
          optionalServices: [serviceUUID]
        });

        log("üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ " + device.name + "...");
        const server = await device.gatt.connect();
        const service = await server.getPrimaryService(serviceUUID);

        log("‚úÖ –°–µ—Ä–≤–∏—Å " + serviceUUID + " –Ω–∞–π–¥–µ–Ω.");

        const characteristics = await service.getCharacteristics();
        log("–ù–∞–π–¥–µ–Ω–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫: " + characteristics.length);

        for (let char of characteristics) {
          log("‚û° –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞: " + char.uuid);
        }

        // –ù–∞–π–¥—ë–º –ø–æ–¥—Ö–æ–¥—è—â—É—é —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É (–º–æ–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å –ø–æ–∑–∂–µ)
        const writeChar = characteristics.find(c => c.properties.write);
        if (!writeChar) {
          log("‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –¥–ª—è –∑–∞–ø–∏—Å–∏.");
          return;
        }

        const encoder = new TextEncoder();
        const value = encoder.encode(key);
        await writeChar.writeValue(value);

        log("üö≤ –í–µ–ª–æ—Å–∏–ø–µ–¥ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω! –ö–ª—é—á –∑–∞–ø–∏—Å–∞–Ω –≤: " + writeChar.uuid);
      } catch (e) {
        log("‚ùå –û—à–∏–±–∫–∞: " + e.message);
        console.error(e);
      }
    }
  </script>
</body>
</html>


