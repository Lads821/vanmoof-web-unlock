<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>üîì–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ VanMoof</title>
  <style>
    body { font-family: sans-serif; background: #f3f3f3; padding: 20px; }
    h1 { font-size: 20px; }
    select, input, button { padding: 8px; margin: 5px 0; }
    #log { background: #fff; border: 1px solid #ccc; padding: 10px; font-family: monospace; white-space: pre-wrap; }
  </style>
</head>
<body>
<h1>üîê–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ VanMoof</h1>

<label>–í—ã–±–µ—Ä–∏—Ç–µ UUID —Å–µ—Ä–≤–∏—Å–∞:</label><br>
<select id="serviceUuid">
  <option value="8e7f1a50-087a-44c9-b292-a2c628fdd9aa">8e7f1a50-087a-44c9-b292-a2c628fdd9aa</option>
</select><br>

<input id="keyInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏" size="40"><br>
<button onclick="unlockBike()">üîì–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤–µ–ª–æ—Å–∏–ø–µ–¥</button><br><br>

<button onclick="setSpeed(25)">üö≤ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–∏–º–∏—Ç 25 –∫–º/—á</button>
<button onclick="setSpeed(32)">üöÄ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–∏–º–∏—Ç 32 –∫–º/—á</button><br><br>

<div id="log">–ì–æ—Ç–æ–≤–æ.</div>

<script>
let log = msg => {
  document.getElementById("log").textContent += "\n" + msg;
};

async function unlockBike() {
  log("üîç –ü–æ–∏—Å–∫ –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞...");
  try {
    const device = await navigator.bluetooth.requestDevice({
      filters: [{ namePrefix: 'VANMOOF' }],
      optionalServices: [document.getElementById('serviceUuid').value]
    });
    log("üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ " + device.name + "...");
    const server = await device.gatt.connect();
    const service = await server.getPrimaryService(document.getElementById('serviceUuid').value);
    const key = document.getElementById("keyInput").value.trim();
    if (!/^[0-9a-fA-F]{32}$/.test(key)) {
      log("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á (–æ–∂–∏–¥–∞–µ—Ç—Å—è 32 hex —Å–∏–º–≤–æ–ª–∞)");
      return;
    }
    const char = await service.getCharacteristic(service.characteristics[0].uuid);
    const bytes = new Uint8Array(key.match(/.{2}/g).map(h => parseInt(h, 16)));
    await char.writeValue(bytes);
    log("‚úÖ –í–µ–ª–æ—Å–∏–ø–µ–¥ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!");
  } catch (e) {
    log("‚ùå –û—à–∏–±–∫–∞: " + e);
  }
}

async function setSpeed(kmh) {
  log("‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–∏–º–∏—Ç–∞ " + kmh + " –∫–º/—á...");
  try {
    const device = await navigator.bluetooth.requestDevice({
      filters: [{ namePrefix: 'VANMOOF' }],
      optionalServices: ["f000ffc0-0451-4000-b000-000000000000"]
    });
    const server = await device.gatt.connect();
    const service = await server.getPrimaryService("f000ffc0-0451-4000-b000-000000000000");
    const char = await service.getCharacteristic("f000ffc3-0451-4000-b000-000000000000");
    const speedByte = new Uint8Array([kmh]);
    await char.writeValue(speedByte);
    log("‚úÖ –õ–∏–º–∏—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: " + kmh + " –∫–º/—á");
  } catch (e) {
    log("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –ª–∏–º–∏—Ç–∞: " + e);
  }
}
</script>

</body>
</html>





